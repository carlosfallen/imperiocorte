---
import AdminLayout from '../../layouts/AdminLayout.astro';
import AdminDashboard from '../../components/admin/AdminDashboard';
import { Database } from '../../lib/db';

const db = new Database(Astro.locals.runtime.env.DB);

const today = new Date().toISOString().split('T')[0];
const startOfMonth = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
const endOfMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).toISOString().split('T')[0];

const todayAppointments = await db.getAllAppointments({ startDate: today, endDate: today });
const pendingAppointments = await db.getAllAppointments({ status: 'pendente' });
const monthlyReports = await db.getReports(startOfMonth, endOfMonth);
---

<AdminLayout title="Dashboard">
  <AdminDashboard 
    client:load
    todayAppointments={todayAppointments}
    pendingAppointments={pendingAppointments}
    monthlyReports={monthlyReports}
  />
</AdminLayout>