---
import AdminLayout from '../../layouts/AdminLayout.astro';
import ReportsManager from '../../components/admin/ReportsManager';
import { Database } from '../../lib/db';

const db = new Database(Astro.locals.runtime.env.DB);

const url = new URL(Astro.request.url);
const startDate = url.searchParams.get('start') || new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
const endDate = url.searchParams.get('end') || new Date().toISOString().split('T')[0];

const reports = await db.getReports(startDate, endDate);
const appointments = await db.getAllAppointments({ startDate, endDate });
---

<AdminLayout title="RelatÃ³rios">
  <ReportsManager 
    client:load
    reports={reports}
    appointments={appointments}
    initialStartDate={startDate}
    initialEndDate={endDate}
  />
</AdminLayout>