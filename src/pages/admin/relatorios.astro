// FILE: src/pages/admin/relatorios.astro
---
import AdminLayout from '../../layouts/AdminLayout.astro';
import ReportsManager from '../../components/admin/ReportsManager';
import { Database } from '../../lib/db';

const db = new Database(Astro.locals.runtime.env.DB);

const url = new URL(Astro.request.url);
const startDate = url.searchParams.get('start') || new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
const endDate = url.searchParams.get('end') || new Date().toISOString().split('T')[0];

const reports = await db.getReports(startDate, endDate);
const appointments = await db.getAllAppointments({ startDate, endDate });
---

<AdminLayout title="Relat√≥rios">
  <ReportsManager 
    client:load
    reports={reports}
    appointments={appointments}
    initialStartDate={startDate}
    initialEndDate={endDate}
  />
</AdminLayout>

// FILE: src/components/admin/ReportsManager.tsx
import { createSignal, createMemo, For } from 'solid-js';
import type { AppointmentWithDetails } from '../../lib/types';
import styles from './ReportsManager.module.css';

interface Props {
  reports: any;
  appointments: AppointmentWithDetails[];
  initialStartDate: string;
  initialEndDate: string;
}

export default function ReportsManager(props: Props) {
  const [startDate, setStartDate] = createSignal(props.initialStartDate);
  const [endDate, setEndDate] = createSignal(props.initialEndDate);

  const applyFilter = () => {
    window.location.href = `/admin/relatorios?start=${startDate()}&end=${endDate()}`;
  };

  const exportCSV = () => {
    const headers = ['Data', 'Hor√°rio', 'Cliente', 'Telefone', 'Servi√ßos', 'Profissional', 'Valor', 'Status', 'Origem'];
    const rows = props.appointments.map(apt => [
      apt.date,
      apt.start_time,
      apt.user_name,
      apt.user_phone,
      apt.items.map(i => i.service_name).join('; '),
      apt.professional_name || 'Qualquer',
      apt.total_price.toFixed(2),
      apt.status,
      apt.source
    ]);

    const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `relatorio-${startDate()}-${endDate()}.csv`;
    a.click();
  };

  const totalRevenue = createMemo(() => {
    return props.appointments
      .filter(apt => apt.status === 'concluido')
      .reduce((sum, apt) => sum + apt.total_price, 0);
  });

  const averageTicket = createMemo(() => {
    const completed = props.appointments.filter(apt => apt.status === 'concluido');
    return completed.length > 0 ? totalRevenue() / completed.length : 0;
  });

  const conversionRate = createMemo(() => {
    const total = props.appointments.length;
    const completed = props.appointments.filter(apt => apt.status === 'concluido').length;
    return total > 0 ? (completed / total) * 100 : 0;
  });

  const noShowRate = createMemo(() => {
    const total = props.appointments.length;
    const noShows = props.appointments.filter(apt => apt.status === 'nao_compareceu').length;
    return total > 0 ? (noShows / total) * 100 : 0;
  });

  return (
    <div class={styles.container}>
      <div class={styles.header}>
        <div>
          <h1>Relat√≥rios</h1>
          <p>An√°lise detalhada do desempenho do sal√£o</p>
        </div>
        <button class={styles['btn-export']} onClick={exportCSV}>
          üìä Exportar CSV
        </button>
      </div>

      <div class={styles.filters}>
        <div class={styles['date-range']}>
          <div>
            <label>Data In√≠cio</label>
            <input
              type="date"
              value={startDate()}
              onInput={(e) => setStartDate(e.currentTarget.value)}
            />
          </div>
          <div>
            <label>Data Fim</label>
            <input
              type="date"
              value={endDate()}
              onInput={(e) => setEndDate(e.currentTarget.value)}
            />
          </div>
          <button class={styles['btn-apply']} onClick={applyFilter}>
            Aplicar
          </button>
        </div>
      </div>

      <div class={styles.metrics}>
        <div class={styles.metric}>
          <div class={styles['metric-icon']} style={{ background: '#4CAF50' }}>
            üí∞
          </div>
          <div class={styles['metric-content']}>
            <p class={styles['metric-label']}>Receita Total</p>
            <p class={styles['metric-value']}>R$ {totalRevenue().toFixed(2)}</p>
          </div>
        </div>

        <div class={styles.metric}>
          <div class={styles['metric-icon']} style={{ background: '#2196F3' }}>
            üéØ
          </div>
          <div class={styles['metric-content']}>
            <p class={styles['metric-label']}>Ticket M√©dio</p>
            <p class={styles['metric-value']}>R$ {averageTicket().toFixed(2)}</p>
          </div>
        </div>

        <div class={styles.metric}>
          <div class={styles['metric-icon']} style={{ background: '#FF9800' }}>
            üìà
          </div>
          <div class={styles['metric-content']}>
            <p class={styles['metric-label']}>Taxa de Convers√£o</p>
            <p class={styles['metric-value']}>{conversionRate().toFixed(1)}%</p>
          </div>
        </div>

        <div class={styles.metric}>
          <div class={styles['metric-icon']} style={{ background: '#F44336' }}>
            ‚ö†Ô∏è
          </div>
          <div class={styles['metric-content']}>
            <p class={styles['metric-label']}>Taxa de Falta</p>
            <p class={styles['metric-value']}>{noShowRate().toFixed(1)}%</p>
          </div>
        </div>
      </div>

      <div class={styles.grid}>
        <div class={styles.card}>
          <div class={styles['card-header']}>
            <h2>Top 10 Servi√ßos</h2>
          </div>
          <div class={styles['chart-container']}>
            <For each={props.reports.topServices}>
              {(service, index) => (
                <div class={styles['bar-item']}>
                  <div class={styles['bar-label']}>
                    <span class={styles.rank}>#{index() + 1}</span>
                    <span>{service.service_name}</span>
                  </div>
                  <div class={styles['bar-wrapper']}>
                    <div 
                      class={styles.bar}
                      style={{ 
                        width: `${(service.count / props.reports.topServices[0].count) * 100}%`,
                        background: `hsl(${45 - index() * 5}, 70%, 50%)`
                      }}
                    >
                      <span class={styles['bar-value']}>{service.count}</span>
                    </div>
                  </div>
                </div>
              )}
            </For>
          </div>
        </div>

        <div class={styles.card}>
          <div class={styles['card-header']}>
            <h2>Profissionais Mais Solicitados</h2>
          </div>
          <div class={styles['chart-container']}>
            <For each={props.reports.topProfessionals}>
              {(prof, index) => (
                <div class={styles['bar-item']}>
                  <div class={styles['bar-label']}>
                    <span class={styles.rank}>#{index() + 1}</span>
                    <span>{prof.name}</span>
                  </div>
                  <div class={styles['bar-wrapper']}>
                    <div 
                      class={styles.bar}
                      style={{ 
                        width: `${(prof.count / props.reports.topProfessionals[0].count) * 100}%`,
                        background: `hsl(${200 - index() * 10}, 70%, 50%)`
                      }}
                    >
                      <span class={styles['bar-value']}>{prof.count}</span>
                    </div>
                  </div>
                </div>
              )}
            </For>
          </div>
        </div>

        <div class={styles.card}>
          <div class={styles['card-header']}>
            <h2>Origem dos Agendamentos</h2>
          </div>
          <div class={styles['stats-list']}>
            <For each={props.reports.bySource}>
              {(source) => (
                <div class={styles['stat-item']}>
                  <div class={styles['stat-info']}>
                    <span class={styles['stat-label']}>{source.source}</span>
                    <span class={styles['stat-percent']}>
                      {((source.count / props.appointments.length) * 100).toFixed(1)}%
                    </span>
                  </div>
                  <div class={styles['progress-bar']}>
                    <div 
                      class={styles.progress}
                      style={{ width: `${(source.count / props.appointments.length) * 100}%` }}
                    />
                  </div>
                  <span class={styles['stat-count']}>{source.count}</span>
                </div>
              )}
            </For>
          </div>
        </div>

        <div class={styles.card}>
          <div class={styles['card-header']}>
            <h2>Status dos Agendamentos</h2>
          </div>
          <div class={styles['stats-list']}>
            <For each={props.reports.byStatus}>
              {(status) => {
                const colors: Record<string, string> = {
                  pendente: '#FFA500',
                  confirmado: '#4CAF50',
                  concluido: '#2196F3',
                  cancelado: '#F44336',
                  nao_compareceu: '#9E9E9E'
                };
                return (
                  <div class={styles['stat-item']}>
                    <div class={styles['stat-info']}>
                      <span class={styles['stat-label']} style={{ color: colors[status.status] }}>
                        {status.status}
                      </span>
                      <span class={styles['stat-percent']}>
                        {((status.count / props.appointments.length) * 100).toFixed(1)}%
                      </span>
                    </div>
                    <div class={styles['progress-bar']}>
                      <div 
                        class={styles.progress}
                        style={{ 
                          width: `${(status.count / props.appointments.length) * 100}%`,
                          background: colors[status.status]
                        }}
                      />
                    </div>
                    <span class={styles['stat-count']}>{status.count}</span>
                  </div>
                );
              }}
            </For>
          </div>
        </div>
      </div>

      <div class={styles.card}>
        <div class={styles['card-header']}>
          <h2>Hist√≥rico de Agendamentos</h2>
        </div>
        <div class={styles.table}>
          <table>
            <thead>
              <tr>
                <th>Data</th>
                <th>Cliente</th>
                <th>Servi√ßos</th>
                <th>Profissional</th>
                <th>Valor</th>
                <th>Origem</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <For each={props.appointments.slice(0, 20)}>
                {(apt) => (
                  <tr>
                    <td>{new Date(apt.date).toLocaleDateString('pt-BR')} {apt.start_time}</td>
                    <td>{apt.user_name}</td>
                    <td>{apt.items.map(i => i.service_name).join(', ')}</td>
                    <td>{apt.professional_name || 'Qualquer'}</td>
                    <td class={styles.price}>R$ {apt.total_price.toFixed(2)}</td>
                    <td><span class={styles.source}>{apt.source}</span></td>
                    <td><span class={styles.status} style={{ background: getStatusColor(apt.status) }}>{apt.status}</span></td>
                  </tr>
                )}
              </For>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}

function getStatusColor(status: string) {
  const colors: Record<string, string> = {
    pendente: '#FFA500',
    confirmado: '#4CAF50',
    concluido: '#2196F3',
    cancelado: '#F44336',
    nao_compareceu: '#9E9E9E'
  };
  return colors[status] || '#666';
}

// FILE: src/components/admin/ReportsManager.module.css
.container {
  max-width: 1400px;
}

.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 2rem;
}

.header h1 {
  font-size: 2rem;
  margin-bottom: 0.25rem;
}

.header p {
  color: var(--color-gray-700);
}

.btn-export {
  padding: 0.875rem 1.75rem;
  background: var(--color-gold);
  color: var(--color-white);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-export:hover {
  background: var(--color-gold-dark);
  transform: translateY(-2px);
}

.filters {
  background: var(--color-white);
  padding: 1.5rem;
  border-radius: 12px;
  margin-bottom: 2rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.date-range {
  display: flex;
  gap: 1rem;
  align-items: flex-end;
}

.date-range > div {
  flex: 1;
}

.date-range label {
  display: block;
  font-weight: 600;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
}

.date-range input {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid var(--color-gray-300);
  border-radius: 8px;
  font-size: 0.95rem;
}

.btn-apply {
  padding: 0.75rem 2rem;
  background: var(--color-gold);
  color: var(--color-white);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  white-space: nowrap;
}

.metrics {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.metric {
  background: var(--color-white);
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  display: flex;
  align-items: center;
  gap: 1rem;
}

.metric-icon {
  width: 56px;
  height: 56px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  font-size: 1.75rem;
}

.metric-content {
  flex: 1;
}

.metric-label {
  font-size: 0.85rem;
  color: var(--color-gray-700);
  margin-bottom: 0.25rem;
}

.metric-value {
  font-size: 1.75rem;
  font-weight: 700;
  color: var(--color-gray-900);
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.card {
  background: var(--color-white);
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  overflow: hidden;
}

.card-header {
  padding: 1.5rem;
  border-bottom: 1px solid var(--color-gray-200);
}

.card-header h2 {
  font-size: 1.25rem;
  font-weight: 600;
}

.chart-container {
  padding: 1.5rem;
}

.bar-item {
  margin-bottom: 1.25rem;
}

.bar-label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
  font-weight: 600;
}

.rank {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  background: var(--color-gray-100);
  border-radius: 4px;
  font-size: 0.75rem;
  color: var(--color-gray-700);
}

.bar-wrapper {
  width: 100%;
  background: var(--color-gray-100);
  border-radius: 6px;
  overflow: hidden;
  height: 32px;
}

.bar {
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding: 0 0.75rem;
  transition: width 0.3s;
}

.bar-value {
  color: white;
  font-weight: 700;
  font-size: 0.85rem;
}

.stats-list {
  padding: 1.5rem;
}

.stat-item {
  margin-bottom: 1.25rem;
}

.stat-item:last-child {
  margin-bottom: 0;
}

.stat-info {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.5rem;
}

.stat-label {
  font-weight: 600;
  font-size: 0.9rem;
  text-transform: capitalize;
}

.stat-percent {
  font-size: 0.85rem;
  color: var(--color-gray-700);
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: var(--color-gray-100);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 0.5rem;
}

.progress {
  height: 100%;
  background: var(--color-gold);
  transition: width 0.3s;
}

.stat-count {
  font-size: 0.85rem;
  color: var(--color-gray-700);
}

.table {
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
}

thead {
  background: var(--color-gray-50);
}

th {
  text-align: left;
  padding: 1rem;
  font-weight: 600;
  font-size: 0.9rem;
  color: var(--color-gray-700);
  border-bottom: 2px solid var(--color-gray-200);
}

td {
  padding: 1rem;
  border-bottom: 1px solid var(--color-gray-100);
  font-size: 0.9rem;
}

tbody tr:hover {
  background: var(--color-gray-50);
}

.price {
  font-weight: 700;
  color: var(--color-gold);
}

.source, .status {
  display: inline-block;
  padding: 0.25rem 0.75rem;
  border-radius: 4px;
  font-size: 0.8rem;
  font-weight: 600;
}

.source {
  background: var(--color-gray-100);
  color: var(--color-gray-900);
}

.status {
  color: white;
}

@media (max-width: 968px) {
  .grid {
    grid-template-columns: 1fr;
  }

  .table {
    overflow-x: auto;
  }

  table {
    min-width: 800px;
  }
}

// FILE: src/pages/admin/configuracoes.astro
---
import AdminLayout from '../../layouts/AdminLayout.astro';
import SettingsManager from '../../components/admin/SettingsManager';
import { Database } from '../../lib/db';

const db = new Database(Astro.locals.runtime.env.DB);

const settings = {
  salon_name: await db.getSetting('salon_name') || 'Imp√©rio Corte',
  salon_address: await db.getSetting('salon_address') || '',
  whatsapp_number: await db.getSetting('whatsapp_number') || '',
  instagram_url: await db.getSetting('instagram_url') || '',
  business_hours_start: await db.getSetting('business_hours_start') || '09:00',
  business_hours_end: await db.getSetting('business_hours_end') || '19:00',
  buffer_time_minutes: await db.getSetting('buffer_time_minutes') || '15',
  min_advance_hours: await db.getSetting('min_advance_hours') || '2',
  max_cancel_hours: await db.getSetting('max_cancel_hours') || '24',
  auto_confirm: await db.getSetting('auto_confirm') || '0',
  max_daily_bookings: await db.getSetting('max_daily_bookings') || '50'
};
---

<AdminLayout title="Configura√ß√µes">
  <SettingsManager client:load settings={settings} />
</AdminLayout>

// FILE: src/components/admin/SettingsManager.tsx
import { createSignal } from 'solid-js';
import styles from './SettingsManager.module.css';

interface Props {
  settings: Record<string, string>;
}

export default function SettingsManager(props: Props) {
  const [settings, setSettings] = createSignal(props.settings);
  const [saving, setSaving] = createSignal(false);
  const [message, setMessage] = createSignal('');

  const updateSetting = (key: string, value: string) => {
    setSettings({ ...settings(), [key]: value });
  };

  const saveSettings = async () => {
    setSaving(true);
    setMessage('');

    try {
      const response = await fetch('/api/admin/settings', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(settings())
      });

      if (response.ok) {
        setMessage('Configura√ß√µes salvas com sucesso!');
        setTimeout(() => setMessage(''), 3000);
      } else {
        throw new Error('Erro ao salvar');
      }
    } catch (error) {
      setMessage('Erro ao salvar configura√ß√µes');
    } finally {
      setSaving(false);
    }
  };

  return (
    <div class={styles.container}>
      <div class={styles.header}>
        <div>
          <h1>Configura√ß√µes</h1>
          <p>Gerencie as configura√ß√µes gerais do sal√£o</p>
        </div>
        <button 
          class={styles['btn-save']} 
          onClick={saveSettings}
          disabled={saving()}
        >
          {saving() ? 'Salvando...' : 'üíæ Salvar Configura√ß√µes'}
        </button>
      </div>

      {message() && (
        <div class={styles.message}>{message()}</div>
      )}

      <div class={styles.sections}>
        <div class={styles.card}>
          <h2>Informa√ß√µes do Sal√£o</h2>
          
          <div class={styles['form-group']}>
            <label>Nome do Sal√£o</label>
            <input
              type="text"
              value={settings().salon_name}
              onInput={(e) => updateSetting('salon_name', e.currentTarget.value)}
            />
          </div>

          <div class={styles['form-group']}>
            <label>Endere√ßo Completo</label>
            <input
              type="text"
              value={settings().salon_address}
              onInput={(e) => updateSetting('salon_address', e.currentTarget.value)}
              placeholder="Rua, n√∫mero - Bairro, Cidade - UF"
            />
          </div>

          <div class={styles['form-group']}>
            <label>WhatsApp (com DDI e DDD)</label>
            <input
              type="text"
              value={settings().whatsapp_number}
              onInput={(e) => updateSetting('whatsapp_number', e.currentTarget.value)}
              placeholder="5511999999999"
            />
          </div>

          <div class={styles['form-group']}>
            <label>Instagram URL</label>
            <input
              type="url"
              value={settings().instagram_url}
              onInput={(e) => updateSetting('instagram_url', e.currentTarget.value)}
              placeholder="https://instagram.com/seu_perfil"
            />
          </div>
        </div>

        <div class={styles.card}>
          <h2>Hor√°rio de Funcionamento</h2>
          
          <div class={styles['form-row']}>
            <div class={styles['form-group']}>
              <label>Abertura</label>
              <input
                type="time"
                value={settings().business_hours_start}
                onInput={(e) => updateSetting('business_hours_start', e.currentTarget.value)}
              />
            </div>

            <div class={styles['form-group']}>
              <label>Fechamento</label>
              <input
                type="time"
                value={settings().business_hours_end}
                onInput={(e) => updateSetting('business_hours_end', e.currentTarget.value)}
              />
            </div>
          </div>

          <div class={styles['form-group']}>
            <label>Tempo de Buffer (minutos)</label>
            <input
              type="number"
              value={settings().buffer_time_minutes}
              onInput={(e) => updateSetting('buffer_time_minutes', e.currentTarget.value)}
              min="0"
              step="5"
            />
            <p class={styles.hint}>Tempo entre agendamentos para limpeza e prepara√ß√£o</p>
          </div>
        </div>

        <div class={styles.card}>
          <h2>Regras de Agendamento</h2>
          
          <div class={styles['form-group']}>
            <label>Anteced√™ncia M√≠nima (horas)</label>
            <input
              type="number"
              value={settings().min_advance_hours}
              onInput={(e) => updateSetting('min_advance_hours', e.currentTarget.value)}
              min="0"
            />
            <p class={styles.hint}>Tempo m√≠nimo necess√°rio entre o agendamento e o atendimento</p>
          </div>

          <div class={styles['form-group']}>
            <label>Prazo para Cancelamento (horas)</label>
            <input
              type="number"
              value={settings().max_cancel_hours}
              onInput={(e) => updateSetting('max_cancel_hours', e.currentTarget.value)}
              min="0"
            />
            <p class={styles.hint}>Clientes s√≥ podem cancelar com esta anteced√™ncia m√≠nima</p>
          </div>

          <div class={styles['form-group']}>
            <label>M√°ximo de Agendamentos por Dia</label>
            <input
              type="number"
              value={settings().max_daily_bookings}
              onInput={(e) => updateSetting('max_daily_bookings', e.currentTarget.value)}
              min="1"
            />
            <p class={styles.hint}>Limite total de agendamentos aceitos por dia</p>
          </div>

          <label class={styles.checkbox}>
            <input
              type="checkbox"
              checked={settings().auto_confirm === '1'}
              onChange={(e) => updateSetting('auto_confirm', e.currentTarget.checked ? '1' : '0')}
            />
            <div>
              <span>Confirma√ß√£o Autom√°tica</span>
              <p class={styles.hint}>Se ativo, agendamentos s√£o confirmados automaticamente. Se n√£o, precisam de aprova√ß√£o manual.</p>
            </div>
          </label>
        </div>

        <div class={styles.card}>
          <h2>Mensagens WhatsApp</h2>
          
          <div class={styles['form-group']}>
            <label>Template de Confirma√ß√£o</label>
            <textarea
              rows={6}
              placeholder="Use vari√°veis: {cliente}, {data}, {horario}, {servicos}, {total}"
              class={styles.template}
            >
              ‚úÖ *AGENDAMENTO CONFIRMADO*{'\n\n'}
              Ol√° {'{cliente}'}, seu agendamento est√° confirmado!{'\n\n'}
              üìÖ Data: {'{data}'}{'\n'}
              üïê Hor√°rio: {'{horario}'}{'\n'}
              üíá Servi√ßos: {'{servicos}'}{'\n'}
              üí∞ Total: R$ {'{total}'}{'\n\n'}
              Nos vemos em breve! ‚ú®
            </textarea>
            <p class={styles.hint}>Mensagem enviada quando o agendamento √© confirmado</p>
          </div>

          <div class={styles['form-group']}>
            <label>Template de Lembrete</label>
            <textarea
              rows={6}
              placeholder="Lembrete enviado 24h antes"
              class={styles.template}
            >
              ‚è∞ *LEMBRETE*{'\n\n'}
              Ol√° {'{cliente}'}!{'\n\n'}
              Lembrando que voc√™ tem agendamento amanh√£:{'\n'}
              üìÖ {'{data}'} √†s {'{horario}'}{'\n\n'}
              Nos vemos em breve! ‚ú®
            </textarea>
            <p class={styles.hint}>Lembrete autom√°tico enviado 24h antes</p>
          </div>
        </div>

        <div class={styles.card}>
          <h2>Zona de Perigo</h2>
          
          <div class={styles.danger}>
            <h3>‚ö†Ô∏è Resetar Dados</h3>
            <p>Esta a√ß√£o ir√° apagar TODOS os agendamentos. Use com extremo cuidado!</p>
            <button class={styles['btn-danger']}>Resetar Agendamentos</button>
          </div>
        </div>
      </div>
    </div>
  );
}

// FILE: src/components/admin/SettingsManager.module.css
.container {
  max-width: 900px;
}

.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 2rem;
}

.header h1 {
  font-size: 2rem;
  margin-bottom: 0.25rem;
}

.header p {
  color: var(--color-gray-700);
}

.btn-save {
  padding: 0.875rem 1.75rem;
  background: var(--color-gold);
  color: var(--color-white);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-save:hover:not(:disabled) {
  background: var(--color-gold-dark);
  transform: translateY(-2px);
}

.btn-save:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.message {
  background: #D4EDDA;
  color: #155724;
  padding: 1rem;
  border-radius: 8px;
  margin-bottom: 1.5rem;
  border-left: 4px solid #28A745;
}

.sections {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.card {
  background: var(--color-white);
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.card h2 {
  font-size: 1.25rem;
  margin-bottom: 1.5rem;
  padding-bottom: 0.75rem;
  border-bottom: 2px solid var(--color-gray-100);
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--color-gray-900);
  font-size: 0.9rem;
}

.form-group input,
.form-group textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid var(--color-gray-300);
  border-radius: 8px;
  font-size: 0.95rem;
  font-family: inherit;
}

.form-group input:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--color-gold);
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.hint {
  font-size: 0.85rem;
  color: var(--color-gray-600);
  margin-top: 0.5rem;
}

.checkbox {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  cursor: pointer;
  padding: 1rem;
  background: var(--color-gray-50);
  border-radius: 8px;
}

.checkbox input {
  margin-top: 0.25rem;
  cursor: pointer;
}

.checkbox span {
  font-weight: 600;
  display: block;
  margin-bottom: 0.25rem;
}

.template {
  font-family: monospace;
  font-size: 0.9rem;
}

.danger {
  padding: 1.5rem;
  background: #FEE;
  border: 2px solid #DC3545;
  border-radius: 8px;
}

.danger h3 {
  color: #DC3545;
  margin-bottom: 0.5rem;
}

.danger p {
  color: #721C24;
  margin-bottom: 1rem;
}

.btn-danger {
  padding: 0.75rem 1.5rem;
  background: #DC3545;
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-danger:hover {
  background: #C82333;
}

// FILE: src/pages/api/admin/settings.ts
import type { APIRoute } from 'astro';
import { Database } from '../../../lib/db';

export const POST: APIRoute = async ({ request, locals }) => {
  try {
    if (!locals.admin) {
      return new Response(JSON.stringify({ error: 'N√£o autorizado' }), {
        status: 401,
        headers: { 'Content-Type': 'application/json' }
      });
    }

    const settings = await request.json() as Record<string, string>;
    const db = new Database(locals.runtime.env.DB);

    for (const [key, value] of Object.entries(settings)) {
      await db.updateSetting(key, value);
    }

    return new Response(JSON.stringify({ success: true }), {
      status: 200,
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (error: any) {
    return new Response(JSON.stringify({ error: error.message }), {
      status: 500,
      headers: { 'Content-Type': 'application/json' }
    });
  }
};